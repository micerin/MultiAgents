"""
AutoGen vs LangGraph - Critic æ¨¡å¼å¯¹æ¯”
======================================

å±•ç¤º AutoGen å’Œ LangGraph å®ç°åŒä¸€ä»»åŠ¡çš„å·®å¼‚

AutoGen æ–¹å¼ï¼šå¯¹è¯å¼ï¼ŒAgent ç›´æ¥äº¤æµ
LangGraph æ–¹å¼ï¼šå›¾é©±åŠ¨ï¼Œé€šè¿‡å…±äº«çŠ¶æ€ä¼ é€’
"""

import os
import sys
import asyncio

sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.dirname(__file__))))

from dotenv import load_dotenv
load_dotenv()

from autogen_agentchat.agents import AssistantAgent
from autogen_agentchat.teams import RoundRobinGroupChat
from autogen_agentchat.conditions import TextMentionTermination, MaxMessageTermination
from autogen_ext.models.openai import AzureOpenAIChatCompletionClient


def get_model_client():
    """è·å– Azure OpenAI æ¨¡å‹å®¢æˆ·ç«¯"""
    return AzureOpenAIChatCompletionClient(
        azure_endpoint=os.getenv("AZURE_OPENAI_ENDPOINT"),
        api_key=os.getenv("AZURE_OPENAI_API_KEY"),
        azure_deployment=os.getenv("AZURE_OPENAI_DEPLOYMENT", "gpt-4o"),
        api_version=os.getenv("AZURE_OPENAI_API_VERSION", "2024-02-01"),
        model="gpt-4o",
    )


async def autogen_critic():
    """AutoGen å®ç°çš„ Critic æ¨¡å¼"""
    
    print("""
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  AutoGen Critic Pattern                     â”‚
    â”‚                                                             â”‚
    â”‚   ç‰¹ç‚¹ï¼š                                                    â”‚
    â”‚   â€¢ å¯¹è¯å¼äº¤äº’ï¼ŒAgent ç›´æ¥å‘æ¶ˆæ¯                            â”‚
    â”‚   â€¢ åŠ¨æ€æµç¨‹ï¼Œæ— éœ€é¢„å®šä¹‰å›¾ç»“æ„                              â”‚
    â”‚   â€¢ ç®€æ´çš„ API                                              â”‚
    â”‚                                                             â”‚
    â”‚   æµç¨‹ï¼š                                                    â”‚
    â”‚   User â”€messageâ”€> Writer â”€messageâ”€> Critic â”€messageâ”€> ...  â”‚
    â”‚                                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """)
    
    model_client = get_model_client()
    
    writer = AssistantAgent(
        name="Writer",
        model_client=model_client,
        system_message="""ä½ æ˜¯ä¸€ä¸ªå†™ä½œåŠ©æ‰‹ã€‚

ä»»åŠ¡ï¼šæ ¹æ®ä¸»é¢˜å†™ä¸€æ®µç®€çŸ­çš„æ–‡å­—ï¼ˆ50-100å­—ï¼‰ã€‚
- é¦–æ¬¡æ”¶åˆ°ä¸»é¢˜æ—¶ï¼Œå†™å‡ºåˆç¨¿
- æ”¶åˆ°æ‰¹è¯„åé¦ˆæ—¶ï¼Œä¿®æ”¹æ–‡ç« 
- å½“ Critic è¯´ APPROVED æ—¶ï¼Œå›å¤ TERMINATE""",
    )
    
    critic = AssistantAgent(
        name="Critic",
        model_client=model_client,
        system_message="""ä½ æ˜¯ä¸€ä¸ªå†™ä½œæ‰¹è¯„å®¶ã€‚

ä»»åŠ¡ï¼šè¯„å®¡ Writer çš„æ–‡ç« ã€‚
æ ‡å‡†ï¼š
1. å†…å®¹æ˜¯å¦æ¸…æ™°
2. è¯­è¨€æ˜¯å¦æµç•…
3. æ˜¯å¦æœ‰å¸å¼•åŠ›

å¦‚æœæ»¡è¶³æ‰€æœ‰æ ‡å‡†ï¼Œå›å¤ï¼šAPPROVED
å¦åˆ™ï¼Œç»™å‡ºå…·ä½“æ”¹è¿›å»ºè®®ï¼ˆæœ€å¤š 2 ç‚¹ï¼‰ã€‚""",
    )
    
    termination = TextMentionTermination("TERMINATE") | MaxMessageTermination(8)
    team = RoundRobinGroupChat([writer, critic], termination_condition=termination)
    
    task = "å†™ä¸€æ®µå…³äº'äººå·¥æ™ºèƒ½ä¸æœªæ¥'çš„çŸ­æ–‡"
    
    print(f"ğŸ“‹ ä»»åŠ¡: {task}\n")
    print("=" * 60)
    
    result = await team.run(task=task)
    
    print("\nğŸ“œ å¯¹è¯è¿‡ç¨‹:")
    for msg in result.messages:
        role = msg.source
        content = msg.content if hasattr(msg, 'content') else str(msg)
        icon = "ğŸ‘¤" if role == "user" else "âœï¸" if role == "Writer" else "ğŸ”"
        print(f"\n{icon} {role}:\n{content[:200]}{'...' if len(content) > 200 else ''}")
    
    await model_client.close()
    return len(result.messages)


def print_comparison():
    """æ‰“å° AutoGen vs LangGraph å¯¹æ¯”"""
    
    print("""
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘              AutoGen vs LangGraph - Critic æ¨¡å¼å¯¹æ¯”               â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘                                                                   â•‘
    â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
    â•‘  â”‚      AutoGen        â”‚    â”‚      LangGraph      â”‚              â•‘
    â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â•‘
    â•‘  â”‚                     â”‚    â”‚                     â”‚              â•‘
    â•‘  â”‚  Writer â†â”€â”€â”€â†’ Criticâ”‚    â”‚  Writer â†’ State â†’ Critic          â•‘
    â•‘  â”‚    (ç›´æ¥æ¶ˆæ¯)       â”‚    â”‚    (å…±äº«çŠ¶æ€)       â”‚              â•‘
    â•‘  â”‚                     â”‚    â”‚                     â”‚              â•‘
    â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
    â•‘                                                                   â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘                                                                   â•‘
    â•‘  å¯¹æ¯”ç»´åº¦           AutoGen              LangGraph                â•‘
    â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
    â•‘  ç¼–æ’æ–¹å¼           å¯¹è¯é©±åŠ¨              å›¾ç»“æ„é©±åŠ¨              â•‘
    â•‘  é€šä¿¡æ–¹å¼           ç›´æ¥æ¶ˆæ¯ä¼ é€’          å…±äº«çŠ¶æ€               â•‘
    â•‘  æ§åˆ¶æµ             éšå¼/åŠ¨æ€             æ˜¾å¼/ç¡®å®šæ€§             â•‘
    â•‘  ä»£ç é‡             è¾ƒå°‘                  è¾ƒå¤š                   â•‘
    â•‘  è°ƒè¯•éš¾åº¦           ä¸­ç­‰                  è¾ƒéš¾                   â•‘
    â•‘  çµæ´»æ€§             é«˜                    ä¸­                     â•‘
    â•‘  å¯é¢„æµ‹æ€§           ä½                    é«˜                     â•‘
    â•‘  ç”Ÿäº§å°±ç»ª           ä¸­ç­‰                  é«˜                     â•‘
    â•‘                                                                   â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘                                                                   â•‘
    â•‘  é€‚ç”¨åœºæ™¯ï¼š                                                       â•‘
    â•‘                                                                   â•‘
    â•‘  AutoGen:                                                         â•‘
    â•‘  â€¢ å¼€æ”¾å¼å¯¹è¯ä»»åŠ¡                                                 â•‘
    â•‘  â€¢ éœ€è¦çµæ´»äº¤äº’çš„åœºæ™¯                                             â•‘
    â•‘  â€¢ å¿«é€ŸåŸå‹å¼€å‘                                                   â•‘
    â•‘                                                                   â•‘
    â•‘  LangGraph:                                                       â•‘
    â•‘  â€¢ å›ºå®šæµç¨‹çš„å·¥ä½œæµ                                               â•‘
    â•‘  â€¢ éœ€è¦çŠ¶æ€æŒä¹…åŒ–çš„ä»»åŠ¡                                           â•‘
    â•‘  â€¢ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²                                                   â•‘
    â•‘                                                                   â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """)


async def main():
    print("""
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘        ğŸ”„ AutoGen vs LangGraph Critic Pattern                â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """)
    
    # è¿è¡Œ AutoGen ç‰ˆæœ¬
    msg_count = await autogen_critic()
    
    # æ‰“å°å¯¹æ¯”
    print("\n" + "=" * 60)
    print_comparison()
    
    print(f"\nâœ… AutoGen Critic å®Œæˆï¼å…± {msg_count} æ¡æ¶ˆæ¯")
    print("\nğŸ’¡ æç¤º: LangGraph ç‰ˆæœ¬è¯·å‚è€ƒ 01_langgraph/02_patterns/reflection_loop.py")


if __name__ == "__main__":
    asyncio.run(main())
